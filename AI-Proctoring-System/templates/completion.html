{% extends "layout.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h2 class="card-title h5 mb-0">Exam Successfully Submitted</h2>
            </div>
            <div class="card-body">
                <div class="text-center mb-4">
                    <div class="mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="40" fill="#28a745"/>
                            <path d="M30 50 L45 65 L70 35" stroke="white" stroke-width="8" fill="none"/>
                        </svg>
                    </div>
                    
                    <h3 class="h4 mb-3">Thank You for Completing the Exam</h3>
                    <p class="lead">Your responses have been recorded successfully.</p>
                </div>
                
                <!-- Session Summary -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card border-info">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0">Session Information</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Session ID:</strong> <code id="session-id">{{ session.user_id }}</code></p>
                                <p><strong>Duration:</strong> <span id="session-duration">Calculating...</span></p>
                                <p><strong>Status:</strong> <span class="badge bg-success">Completed</span></p>
                                <p><strong>Completion Time:</strong> <span id="completion-time"></span></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-secondary">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0">Data Collected</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Screenshots:</strong> <span id="screenshot-count">-</span></p>
                                <p><strong>Audio Files:</strong> <span id="audio-count">-</span></p>
                                <p><strong>Answers Saved:</strong> <span id="answer-count">-</span></p>
                                <p><strong>Detections:</strong> <span id="detection-count">-</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info mt-4">
                    <h5><i class="fas fa-info-circle"></i> Next Steps</h5>
                    <ul class="mb-0">
                        <li>Your exam will be evaluated and results will be communicated via email</li>
                        <li>All session data has been securely stored for review</li>
                        <li>Keep your session ID for reference if you need assistance</li>
                    </ul>
                </div>
                
                <div class="text-center mt-4">
                    <a href="/" class="btn btn-primary btn-lg">Return to Home</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set completion time
    document.getElementById('completion-time').textContent = new Date().toLocaleString();
    
    // Get session summary from server
    const sessionId = document.getElementById('session-id').textContent;
    
    fetch('/api/complete_exam', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            session_id: sessionId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success' && data.summary) {
            const summary = data.summary;
            
            // Update duration
            document.getElementById('session-duration').textContent = summary.duration_formatted || 'Unknown';
            
            // Update file counts
            if (summary.files_created) {
                document.getElementById('screenshot-count').textContent = summary.files_created.screenshots || 0;
                document.getElementById('audio-count').textContent = summary.files_created.audio_files || 0;
                document.getElementById('answer-count').textContent = summary.files_created.answer_files || 0;
            }
            
            // Update detection count
            document.getElementById('detection-count').textContent = summary.detection_count || 0;
        }
    })
    .catch(error => {
        console.error('Error fetching session summary:', error);
    });
});
</script>
{% endblock %}